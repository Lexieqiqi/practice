function ModuleLogic(view){var that=this;this.initObj={};this.init=function(){this.currenPageId="select";this.nextPageId=null;this.initEvent();that.getValue()};this.initEvent=function(){$("#selectNext").on("click",function(){var selected=false,upperWifiName="",securityMode="",channel="",signal="",obj={};$('[name="wifiSelect"]').each(function(){var trIndex=$(this).parents("tr").attr("index");if($(this)[0].checked){selected=true;upperWifiName=that.initObj[trIndex].wifiScanSSID;securityMode=that.initObj[trIndex].wifiScanSecurityMode;channel=that.initObj[trIndex].wifiScanChannel;signal=that.initObj[trIndex].wifiScanSignalStrength}});if(!selected){alert(_("Please select a WiFi nameâ€¦"));return}if(securityMode==="UNKNOW"){alert(_("The encryption of the base station is WEP. The extender doesn't support this encryption (WEP)."));return}if(parseInt(signal)<-72){alert(_("The selected WiFi signal is weak. For stable connection, move the extender close to the wireless router or access point."))}obj={wifiName:upperWifiName,wifiSecurityMode:securityMode,wifiChannel:channel};view.changePage("select","details");view.initHtml(obj);if(securityMode==="NONE"){$("#wifiPwdCon").addClass("none")}else{$("#wifiPwdCon").removeClass("none");$("#wifiPwd").val("").attr({disabled:false,placeholder:_("Enter the WiFi password of the Base Station")})}});$("#back").on("click",function(){view.changePage("details","select")});$("#keepUpper").on("click",view.checkKeepUppserStauts);$("#ok").on("click",function(){view.validate.checkAll()});$("#refreshTable").on("click",function(){that.getValue()});$("#extend").on("click",function(){window.location.reload()});var newInput,$ele=$("#extenderPwd");if(isSupChangeType($ele)){$("#iconContainer").on("click",".icon-show",function(){$(this).removeClass("icon-show").addClass("icon-hide");$ele.attr("type","text")});$("#iconContainer").on("click",".icon-hide",function(){$(this).removeClass("icon-hide").addClass("icon-show");$ele.attr("type","password")})}else{}var newInput1,$ele1=$("#wifiPwd");if(isSupChangeType($ele)){$("#wifiPwdCon").on("click",".icon-show",function(){$(this).removeClass("icon-show").addClass("icon-hide");$ele1.attr("type","text")});$("#wifiPwdCon").on("click",".icon-hide",function(){$(this).removeClass("icon-hide").addClass("icon-show");$ele1.attr("type","password")})}else{}$("#extenderName").addPlaceholder(_("WiFi Name of the Extender"));$("#extenderPwd").initPassword(_("WiFi Password of the Extender"));$("#wifiPwd").initPassword(_("Enter the WiFi password of the Base Station"));$("#wifiPwd_").parent().find(".placeholder-text").css("width","285px")};this.getValue=function(){$("#wifiScanTbody").html("");$("#selectNext").addClass("none");$("#refreshTable").addClass("none");$("#wifiScan").prev().addClass("invisible");$("#loading").removeClass("none");$.GetSetData.setData("goform/getWizard",{random:Math.random(),module1:"wifiScan"},that.initValue)};this.initValue=function(obj){var timeoutStr='<tr><td colspan="3" class="text-danger">'+_("SSID Scanning timed out!")+"</td></tr>";try{obj=$.parseJSON(obj)}catch(e){$("#wifiScanTbody").html("");$("#wifiScanTbody").append(timeoutStr);return}if(obj.timeout){$("#wifiScanTbody").html("");$("#wifiScanTbody").append(timeoutStr)}$("#loading").addClass("none");$("#refreshTable").removeClass("none");if(!obj.wifiScan){return}$("#wifiScan").prev().removeClass("invisible");var listObj=obj.wifiScan.sort(function(a,b){if(parseInt(a.wifiScanSignalStrength)>parseInt(b.wifiScanSignalStrength)){return -1}else{return 1}}),tableStr="",signal;that.initObj=obj.wifiScan;$("#selectNext").removeClass("none");for(var i=0,l=listObj.length;i<l;i++){tableStr+='<tr index="'+i+'"><td style="width: 20%"><input type="radio" name="wifiSelect"/></td>';tableStr+='<td style="width: 30%" class="fixed" title="'+escapeText(listObj[i].wifiScanSSID)+'">'+escapeText(listObj[i].wifiScanSSID)+"</td>";signal=parseInt(listObj[i].wifiScanSignalStrength,10);if(signal>=-45){signal="signal-4"}else{if(signal<-45&&signal>=-60){signal="signal-3"}else{if(signal<-60&&signal>=-74){signal="signal-2"}else{signal="signal-1"}}}tableStr+='<td style="width: 25%;padding-right: 10px;"><span class="'+signal+' scan-icon"></span>';if(listObj[i].wifiScanSecurityMode!=="NONE"){tableStr+='<span class="icon-lock scan-icon"><input type="hidden" value='+listObj[i].wifiScanSecurityMode+'><input type="hidden" value='+listObj[i].wifiScanChannel+"></span>"}else{tableStr+='<span><input type="hidden" value="NONE"/></span>'}tableStr+="</td></tr>"}$("#wifiScanTbody").append(tableStr)}}function isSupChangeType(passwordElem){try{passwordElem.attr("type","text");if(passwordElem.attr("type")==="text"){passwordElem.attr("type","password");return true}}catch(d){return false}}function ModuleView(){var that=this;this.currenPageId=null;this.nextPageId=null;this.checkKeepUppserStauts=function(){var selected=$("#keepUpper").prop("checked");if(selected){$("#extenderInfo").addClass("none")}else{$("#extenderInfo").removeClass("none")}};this.initHtml=function(obj){$("#wifiName").html(obj.wifiName);$("#wifiSecurityMode").val(obj.wifiSecurityMode);$("#wifiChannel").val(obj.wifiChannel);$("#keepUpper").prop("checked",true);that.checkKeepUppserStauts()};function endSetup(){var checkBridgeT=null,timer=0,bridgeReturnFlag=false;$("#savingWrap").show();$("#savedWrap").hide();checkBridgeT=setInterval(function(){if(timer>(30000/500)){clearInterval(checkBridgeT);if(bridgeReturnFlag){extendFail(_("Timed Out! Please extend again!"))}else{$("#savingWrap").hide();$("#savedWrap").show();$("#successinternetWrap").html(_("Extended Successfully!")).show();$("#savedWrap .content").html("&nbsp;").addClass("icon-success")}}else{timer++}bridgeReturnFlag=false;$.GetSetData.getJson("goform/getStatusBeforeBridge",function(data){bridgeReturnFlag=true;if(data.extended==="0"){clearInterval(checkBridgeT);extendFail(_("Failed to extend. Please extend again!"))}else{if(data.extended==="1"){clearInterval(checkBridgeT);$("#savingWrap").hide();$("#savedWrap").show();$("#successinternetWrap").html(_("Extended Successfully!")).show();$("#savedWrap .content").html("&nbsp;").addClass("icon-success")}}})},500)}function extendFail(msg){$("#savingWrap").hide();$("#savedWrap").show();$("#successinternetWrap").html(msg).show();$("#nameModified").hide();$("#extend").show();$("#savedWrap .content").html("&nbsp;").addClass("icon-cancel").css("width","202px")}this.changePage=function(currenPage,nextPage){$("#"+currenPage).hide();$("#"+nextPage).show();this.currenPageId=currenPage;this.nextPageId=nextPage;$(".breadcrumb .active").removeClass("active");if(nextPage==="details"){$(".breadcrumb").find("li").eq(1).addClass("active")}else{if(nextPage==="select"){$(".breadcrumb").find("li").eq(0).addClass("active")}else{$(".text-right").hide()}}if(nextPage=="doneWrap"){$("#ssid-msg").text("modifiedName");endSetup()}};this.validate=$.validate({custom:function(){},success:function(){that.preSubmit()},error:function(msg){}});this.preSubmit=function(){var checked=$("#keepUpper").prop("checked");var data={module1:"setExtenderWifi",wifiRelaySSID:$("#wifiName").text()||"",wifiRelaySecurityMode:$("#wifiSecurityMode").val()||"",wifiRelayPwd:$("#wifiPwd").val()||"",wifiRelayChannel:$("#wifiChannel").val()||"",wizardSSID:checked?($("#wifiName").text()||""):($("#extenderName").val()||""),wizardSSIDPwd:checked?($("#wifiPwd").val()||""):($("#extenderPwd").val()||"")};$("#nameModified").removeClass("none").html(_("The WiFi name of the extender is changed into %s, please connect again.",[data.wizardSSID]));that.changePage("details","doneWrap");var subStr=objToString(data);$.post("goform/setWizard",subStr,function(){})}}$(function(){var moduleView=new ModuleView();var moduleLogic=new ModuleLogic(moduleView);moduleLogic.init()});